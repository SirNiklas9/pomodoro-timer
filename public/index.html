<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <title>Pomodoro Timer</title>
</head>
<body>
    <h1>Pomodoro Timer</h1>
    <div id="status">Connecting</div>
    <div id="timer">00:03</div>

    <button id="start">Start</button>
    <button id="stop">Stop</button>
    <button id="reset">Reset</button>

    <script>
        const ws = new WebSocket('ws://localhost:3000');
        const status = document.getElementById('status');
        const sounds = {
            start: new Audio("/sounds/start.mp3"),
            stop: new Audio("/sounds/stop.mp3"),
            reset: new Audio("/sounds/reset.mp3"),
            simpleComplete: new Audio("/sounds/simple-ding.mp3"),
            complexComplete: new Audio("/sounds/complex-ding.mp3"),
            }

        ws.onopen = () => {
            status.textContent = 'Connected';
        };

        ws.onmessage = (event) => {
            console.log("Got message: ", event.data);
            const data = JSON.parse(event.data);
            console.log("Parsed: ", data);
            if (data.type == "tick") {
                const minutes = Math.floor(data.timeLeft / 60);
                const seconds = data.timeLeft % 60;
                const timer = document.getElementById('timer');
                timer.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            }

            if (data.timeLeft == 0) {
                sounds.complexComplete.play();
            }
        };

        ws.onclose = () => {
            status.textContent = 'Disconnected';
        };

        document.getElementById('start').onclick = () => {
            ws.send(JSON.stringify({type: 'start'}));
            sounds.start.play();
        };

        document.getElementById('stop').onclick = () => {
            ws.send(JSON.stringify({type: 'stop'}));
            sounds.stop.play();
        };

        document.getElementById('reset').onclick = () => {
            ws.send(JSON.stringify({type: 'reset'}));
            sounds.reset.play();
        };
    </script>
</body>
</html>